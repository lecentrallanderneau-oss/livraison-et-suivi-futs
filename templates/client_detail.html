{% extends "base.html" %}
{% block title %}{{ client.name }} — Détail{% endblock %}
{% block content %}
<h1>{{ client.name }} — Détail</h1>

<h2>Solde par variante</h2>
<table>
  <thead>
    <tr>
      <th>Produit</th>
      <th>Variante</th>
      <th>Solde fûts</th>
    </tr>
  </thead>
  <tbody>
    {% set has_any = false %}
    {% for (cid, vid), qty in client_totals.items() %}
      {% if qty != 0 %}
        {% set has_any = true %}
        {% set v = variants[vid] %}
        <tr>
          <td>{{ v.product.name }}</td>
          <td>{{ v.volume_l }} L</td>
          <td>{{ qty }}</td>
        </tr>
      {% endif %}
    {% endfor %}
    {% if not has_any %}
      <tr><td colspan="3"><em>Aucun fût en cours pour ce client.</em></td></tr>
    {% endif %}
  </tbody>
</table>

<h2>Historique des mouvements</h2>
<table>
  <thead>
    <tr>
      <th>Date</th>
      <th>Type</th>
      <th>Produit</th>
      <th>Variante</th>
      <th>Quantité</th>
    </tr>
  </thead>
  <tbody>
    {% if moves %}
      {% for m in moves %}
        <tr>
          <td>{{ m.created_at.strftime('%d/%m/%Y %H:%M') }}</td>
          <td>{{ m.type }}</td>
          <td>{{ m.variant.product.name }}</td>
          <td>{{ m.variant.volume_l }} L</td>
          <td>{{ m.quantity }}</td>
        </tr>
      {% endfor %}
    {% else %}
      <tr><td colspan="5"><em>Aucun mouvement saisi.</em></td></tr>
    {% endif %}
  </tbody>
</table>
{% endblock %}
