{% extends "base.html" %}
{% block title %}Vue d'ensemble{% endblock %}
{% block content %}
<h1>Vue d'ensemble — Soldes de fûts par client</h1>

<p>Le solde correspond à <strong>livraisons (OUT) − reprises (IN)</strong>.</p>

<div class="grid cols-2">
  {% for client in clients %}
    <section>
      <h2>{{ client.name }}</h2>
      <table>
        <thead>
          <tr>
            <th>Produit</th>
            <th>Variante</th>
            <th>Solde fûts</th>
          </tr>
        </thead>
        <tbody>
          {% set has_any = false %}
          {% for variant in variants %}
            {% set key = (client.id, variant.id) %}
            {% set qty = totals.get(key, 0) %}
            {% if qty != 0 %}
              {% set has_any = true %}
              <tr>
                <td>{{ variant.product.name }}</td>
                <td>{{ variant.volume_l }} L</td>
                <td>{{ qty }}</td>
              </tr>
            {% endif %}
          {% endfor %}
          {% if not has_any %}
          <tr><td colspan="3"><em>Aucun fût en cours.</em></td></tr>
          {% endif %}
        </tbody>
      </table>
      <p><a class="btn secondary" href="{{ url_for('client_detail', client_id=client.id) }}">Détail client</a></p>
    </section>
  {% endfor %}
</div>
{% endblock %}
