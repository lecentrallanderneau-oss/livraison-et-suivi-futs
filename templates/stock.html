{% extends "base.html" %}
{% import "_macros.html" as ui %}
{% block title %}Stock bar{% endblock %}
{% block content %}
<div class="d-flex align-items-center justify-content-between">
  <h1 class="h3 mb-0">Stock bar (fûts pleins)</h1>
  <a href="{{ url_for('movement_wizard') }}" class="btn btn-outline-primary">+ Saisie</a>
</div>
<hr>

{{ ui.alerts_list(alerts) }}

<form method="post" class="card">
  <div class="card-body p-0">
    <table class="table table-sm mb-0 align-middle">
      <thead>
        <tr>
          <th>Produit</th>
          <th class="text-center" style="width:100px;">Taille</th>
          <th class="text-end" style="width:140px;">Prix TTC</th>
          <th class="text-end" style="width:160px;">Stock (fûts)</th>
          <th class="text-end" style="width:160px;">Seuil mini</th>
        </tr>
      </thead>
      <tbody>
        {% if rows and rows|length > 0 %}
          {% for it in rows %}
            {% set v = it.variant %}
            <tr>
              <td>{{ (v.product.name if v and v.product else '—') }}</td>
              <td class="text-center">{{ (v.size_l if v else '—') }} L</td>
              <td class="text-end">
                {% if v and v.price_ttc is not none %}
                  {{ '%.2f'|format(v.price_ttc) }} €
                {% else %}
                  —
                {% endif %}
              </td>
              <td>
                <input type="number"
                       name="qty_{{ v.id if v else 0 }}"
                       class="form-control text-end"
                       min="0" step="1"
                       value="{{ (it.inventory.qty if it.inventory else 0) }}">
              </td>
              <td>
                <input type="number"
                       name="min_{{ v.id if v else 0 }}"
                       class="form-control text-end"
                       min="0" step="1"
                       value="{{ (it.rule.min_qty if it.rule else 0) }}">
              </td>
            </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="5" class="text-muted text-center">Aucune référence trouvée.</td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
  <div class="card-footer d-flex gap-2">
    <button class="btn btn-primary" type="submit">Enregistrer l’inventaire</button>
    <a class="btn btn-outline-secondary" href="{{ url_for('index') }}">Retour</a>
  </div>
</form>
{% endblock %}
